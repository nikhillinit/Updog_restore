# Environment Variables Configuration
# Copy to .env and update values for your environment

# Database (required for production)
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/povc_dev

# Redis (optional - for background jobs and caching)
REDIS_URL=redis://localhost:6379

# Node environment
NODE_ENV=development

# Server configuration
PORT=5000
# CRITICAL SECURITY WARNING: Generate strong secrets before deployment!
# Run: npm run secret-gen
# NEVER use these placeholder values in production
SESSION_SECRET=GENERATE_STRONG_SECRET_WITH_npm_run_secret-gen

# Request body limits (default: 1mb)
# BODY_LIMIT=1mb

# Trust proxy configuration (important for production)
# Local/dev: loopback, linklocal, uniquelocal (default)
# Behind single proxy: 1
# Behind known CIDR: 10.0.0.0/8, 172.16.0.0/12
# TRUST_PROXY=loopback, linklocal, uniquelocal

# CORS configuration (comma-separated origins)
# CORS_ORIGIN=http://localhost:5173,http://localhost:5000

# API origin for CSP connect-src directive
# API_ORIGIN=http://localhost:5000

# ===== TELEMETRY & MONITORING =====

# RUM v2 Feature Flag (set to 1 to enable enhanced telemetry)
ENABLE_RUM_V2=0

# Client-side RUM v2 flag
VITE_ENABLE_RUM_V2=0

# RUM configuration
RUM_MAX_ROUTES=1000
RUM_MAX_LABELS=50
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:5000

# Sentry configuration (optional)
ENABLE_SENTRY=0
VITE_ENABLE_SENTRY=0
# SENTRY_DSN=https://your-key@sentry.io/project-id
# VITE_SENTRY_DSN=https://your-key@sentry.io/project-id

# Monitoring endpoints
# PROMETHEUS_URL=http://localhost:9090
# ALERTMANAGER_URL=http://localhost:9093
# GRAFANA_URL=http://localhost:3000
# GRAFANA_API_KEY=your-grafana-api-key

# Health endpoint protection (optional)
# HEALTH_KEY=your-secret-key-here

# Shutdown configuration
# SHUTDOWN_RETRY_AFTER_SECONDS=30

# Rate limiting (optional - for cluster deployments)
# RATE_LIMIT_REDIS_URL=redis://localhost:6379

# Idempotency configuration
IDEMPOTENCY_MAX=5000
IDEMPOTENCY_TTL=86400

# Monitoring (optional)
# SENTRY_DSN=https://your-sentry-dsn
# VITE_SENTRY_DSN=https://your-frontend-sentry-dsn
# VITE_GIT_SHA=commit-sha-for-release
# VITE_SENTRY_TRACES_RATE=0.05
# VITE_SENTRY_ERROR_RATE=1.00
# PROMETHEUS_PORT=9090
# PROMETHEUS_URL=http://localhost:9090
# PUSHGATEWAY_URL=http://localhost:9091

# RUM Configuration
# RUM_ORIGIN_ALLOWLIST=https://app.example.com,https://staging.example.com
# RUM_SAMPLE_RATE=0.2

# === Auth (choose one) ===
JWT_ALG=HS256
# CRITICAL SECURITY WARNING: Generate strong secrets before deployment!
# Run: npm run secret-gen
# NEVER use these placeholder values in production
JWT_SECRET=GENERATE_STRONG_SECRET_WITH_npm_run_secret-gen
# For RS256:
# JWT_ALG=RS256
# JWT_JWKS_URL=https://your-idp/.well-known/jwks.json

# === Feature flags ===
DEMO_MODE=0
REQUIRE_AUTH=1
ENGINE_FAULT_RATE=0
CSP_REPORT_ONLY=0
ENABLE_WEBSOCKETS=false
ENABLE_WORKERS=false

# AI Agent System (Phase 1)
# IMPORTANT: Keep OFF in prod until Excel parity validated (Issue #1)
AI_EVAL_ENABLED=false          # OFF in prod until Excel parity validated
AI_STREAMING_ENABLED=false     # OFF in prod until Issue #1 complete
AI_TOKEN_BUDGET_USD=10.0       # Per-operation default ceiling

# Circuit Breaker Configuration (start with flags disabled for shadow mode)
# Cache circuit breaker (Redis protection)
CB_CACHE_ENABLED=false
CB_CACHE_FAILURE_THRESHOLD=5
CB_CACHE_RESET_TIMEOUT_MS=30000
CB_CACHE_OP_TIMEOUT_MS=2000
CB_CACHE_SUCCESS_TO_CLOSE=3
CB_CACHE_HALF_OPEN_MAX_CONC=2

# HTTP circuit breaker (external APIs)
CB_HTTP_ENABLED=false
CB_HTTP_FAILURE_THRESHOLD=3
CB_HTTP_RESET_TIMEOUT_MS=60000
CB_HTTP_OP_TIMEOUT_MS=5000
CB_HTTP_SUCCESS_TO_CLOSE=2
CB_HTTP_HALF_OPEN_MAX_CONC=1

# Database circuit breaker (keep disabled initially)
CB_DB_ENABLED=false
CB_DB_FAILURE_THRESHOLD=3
CB_DB_RESET_TIMEOUT_MS=30000
CB_DB_OP_TIMEOUT_MS=10000
CB_DB_SUCCESS_TO_CLOSE=2
CB_DB_HALF_OPEN_MAX_CONC=1

# External services (optional)
# NATS_URL=nats://localhost:4222
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/...

# Development overrides
# VITE_API_URL=http://localhost:5000
# READYZ_STRICT=false