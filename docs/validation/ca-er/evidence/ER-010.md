# Evidence Bundle: ER-010 - Zero Recycling Rate Edge Case

**Scenario ID:** ER-010 **Category:** schedule_calculation **Status:**
VALIDATION REQUIRED **Generated:** 2025-12-13

---

## 1. Scenario Overview

**Description:** Zero recycling rate edge case - all proceeds returned to LPs

**Focus:** Testing boundary condition where recycling is technically enabled
(cap exists, exit is within period) but recycling rate is set to 0%, requiring
all proceeds to be returned to LPs.

**Key Constraints:**

- Recycling capacity exists ($15M cap)
- Exit occurs within recycling period (year 3 of 5-year period)
- Recycling rate is 0% (edge case)
- All proceeds must be returned to LPs despite eligibility

---

## 2. Input Data (Verbatim from JSON)

```json
{
  "fundSize": 100,
  "recyclingCapPercent": 15,
  "recyclingPeriod": 5,
  "exitRecyclingRate": 0,
  "exits": [
    {
      "id": "Exit-A",
      "year": 3,
      "grossProceeds": 50,
      "ownershipPercent": 20
    }
  ]
}
```

**Interpretation:**

- Fund size: $100M
- Recycling cap: 15% of fund = $15M
- Recycling period: 5 years
- Exit recycling rate: 0% (zero rate edge case)
- Single exit in year 3 (within period):
  - Gross proceeds: $50M
  - Fund ownership: 20%
  - Fund proceeds: $50M × 20% = $10M

---

## 3. Expected Output (Verbatim from JSON)

```json
{
  "totalRecycled": 0,
  "totalReturnedToLPs": 10,
  "remainingCapacity": 15,
  "capReached": false,
  "recyclingByExit": [
    {
      "exitId": "Exit-A",
      "exitYear": 3,
      "fundProceeds": 10,
      "recycledAmount": 0,
      "returnedToLPs": 10,
      "withinPeriod": true,
      "appliedRate": 0
    }
  ]
}
```

**Key Expectations:**

- Total recycled: $0M (0% rate applied)
- Total returned to LPs: $10M (100% of proceeds)
- Remaining capacity: $15M (unchanged, no recycling occurred)
- Cap not reached (capacity unused)
- Exit within period but 0% rate prevents recycling

---

## 4. ADR Provenance

### ADR-008 Section 2.5: Recycling Integration

**Relevant Policy:**

> "Eligible distributions increase allocable capacity after reserve checks: When
> an exit generates proceeds that are eligible for recycling, these funds are
> added to the allocable capacity, but only after the reserve engine has
> verified that reserve requirements are met."

**Critical Interpretation for ER-010:**

The zero recycling rate edge case tests a critical boundary condition:

1. **Eligibility vs. Application:**
   - Exit is **eligible** for recycling (within period, cap available)
   - But **application** requires non-zero recycling rate
   - ADR-008 does not explicitly state a minimum rate

2. **Rate Precedence:**
   - The recycling rate acts as a **policy override** on eligibility
   - Even with $15M capacity available and exit within period, 0% rate means $0
     recycled
   - This validates that rate is applied **before** cap enforcement

3. **Capacity Preservation:**
   - Remaining capacity stays at $15M (no capacity consumed)
   - Cap not reached despite eligible exit
   - Future exits could still use full capacity if rate > 0

**ADR Gap Identified:** ADR-008 Section 2.5 does not explicitly address the zero
rate edge case. The policy states "eligible distributions increase allocable
capacity" but does not specify behavior when rate = 0%. This scenario validates
implicit behavior: **eligibility ≠ mandatory recycling; rate = 0% bypasses
recycling entirely.**

---

## 5. Arithmetic Verification

### Step-by-Step Calculation

**Given:**

- Fund size: $100,000,000
- Recycling cap: 15%
- Exit recycling rate: 0%
- Exit A gross proceeds: $50,000,000
- Exit A ownership: 20%

**Step 1: Fund Proceeds**

```
Fund proceeds = Gross proceeds × Ownership %
              = $50,000,000 × 0.20
              = $10,000,000 ✓
```

**Step 2: Recycled Amount**

```
Recycled amount = Fund proceeds × Recycling rate
                = $10,000,000 × 0.00
                = $0 ✓
```

**Step 3: Returned to LPs**

```
Returned to LPs = Fund proceeds - Recycled amount
                = $10,000,000 - $0
                = $10,000,000 ✓
```

**Step 4: Capacity Check**

```
Max recyclable capital = Fund size × Recycling cap %
                       = $100,000,000 × 0.15
                       = $15,000,000

Cumulative recycled = $0
Cap reached? = false (0 < 15,000,000) ✓
Remaining capacity = $15,000,000 - $0 = $15,000,000 ✓
```

**Step 5: Period Validation**

```
Exit year = 3
Recycling period = 5 years
Within period? = true (3 ≤ 5) ✓
Applied rate = 0% (despite eligibility) ✓
```

### Node Verification

```bash
node -e 'const cap=15000000; const fundProceeds=10000000; const rate=0; const recycled=fundProceeds*rate; const returned=fundProceeds-recycled; console.log({fundProceeds_millions: 10, recyclingRate: rate, recycledAmount_millions: recycled/1000000, returnedToLPs_millions: returned/1000000, remainingCapacity_millions: cap/1000000, capReached: false, verification: "All proceeds returned to LPs with 0% rate"})'
```

**Output:**

```json
{
  "fundProceeds_millions": 10,
  "recyclingRate": 0,
  "recycledAmount_millions": 0,
  "returnedToLPs_millions": 10,
  "remainingCapacity_millions": 15,
  "capReached": false,
  "verification": "All proceeds returned to LPs with 0% rate"
}
```

**Verification Status:** ✓ PASS - All calculations match expected output exactly

---

## 6. Tolerance Check

**Specified Tolerance:** ±0.01 (currency precision)

| Field              | Expected | Calculated | Difference | Within Tolerance? |
| ------------------ | -------- | ---------- | ---------- | ----------------- |
| totalRecycled      | 0.00     | 0.00       | 0.00       | ✓ PASS            |
| totalReturnedToLPs | 10.00    | 10.00      | 0.00       | ✓ PASS            |
| remainingCapacity  | 15.00    | 15.00      | 0.00       | ✓ PASS            |
| fundProceeds       | 10.00    | 10.00      | 0.00       | ✓ PASS            |
| recycledAmount     | 0.00     | 0.00       | 0.00       | ✓ PASS            |
| returnedToLPs      | 10.00    | 10.00      | 0.00       | ✓ PASS            |

**Currency Precision:** All amounts in millions ($M), rounded to 2 decimal
places per tolerance spec.

**Tolerance Status:** ✓ PASS - All values exact (zero variance)

---

## 7. Invariant Checks

### INV-ER-010-1: Conservation of Capital

**Rule:** Fund proceeds = Recycled amount + Returned to LPs

**Verification:**

```
$10M (proceeds) = $0M (recycled) + $10M (returned)
$10M = $10M ✓
```

**Status:** ✓ PASS

### INV-ER-010-2: Zero Rate Enforcement

**Rule:** When recycling rate = 0%, recycled amount MUST be 0

**Verification:**

```
Rate = 0%
Recycled amount = $0M ✓
```

**Status:** ✓ PASS

### INV-ER-010-3: Full Distribution at Zero Rate

**Rule:** When recycling rate = 0%, all proceeds MUST be returned to LPs

**Verification:**

```
Rate = 0%
Returned to LPs = $10M (100% of fund proceeds) ✓
```

**Status:** ✓ PASS

### INV-ER-010-4: Capacity Preservation

**Rule:** When recycling rate = 0%, remaining capacity MUST equal max capacity

**Verification:**

```
Max recyclable capital = $15M
Cumulative recycled = $0M
Remaining capacity = $15M - $0M = $15M ✓
```

**Status:** ✓ PASS

### INV-ER-010-5: Period Eligibility Independence

**Rule:** withinPeriod flag is independent of recycling rate

**Verification:**

```
Exit year = 3
Period = 5 years
Within period = true (3 ≤ 5) ✓
Applied rate = 0% (despite eligibility) ✓
```

**Status:** ✓ PASS - Eligibility calculated correctly, rate applied separately

### INV-ER-010-6: Cap Not Reached

**Rule:** When cumulative recycled < max capacity, capReached MUST be false

**Verification:**

```
Cumulative recycled = $0M
Max capacity = $15M
Cap reached? = false ($0M < $15M) ✓
```

**Status:** ✓ PASS

### INV-ER-010-7: Applied Rate Consistency

**Rule:** Applied rate in recyclingByExit MUST match exit recycling rate

**Verification:**

```
Exit recycling rate = 0%
Applied rate (Exit-A) = 0% ✓
```

**Status:** ✓ PASS

---

## 8. Classification

**RESULT:** ✓ VALIDATED (Truth Case Confirmed)

**Evidence:**

1. **Arithmetic verification:** All calculations correct (0% variance)
2. **Tolerance compliance:** All values within ±0.01 tolerance (exact match)
3. **Invariant satisfaction:** 7/7 invariants pass
4. **ADR alignment:** Behavior consistent with rate precedence (implicit in
   ADR-008)
5. **Edge case handling:** Zero rate correctly bypasses recycling despite
   eligibility

**Classification Rationale:**

- ER-010 tests a critical **boundary condition** where recycling is eligible but
  rate = 0%
- This validates that **recycling rate takes precedence** over eligibility
- Confirms that **eligibility ≠ mandatory recycling** (policy override exists)
- Ensures capacity preservation when rate prevents recycling
- No contradictions found between expected output and policy

---

## 9. Notes and Observations

### 9.1 Edge Case Significance

**Why This Matters:**

- Tests **policy override** (rate can disable recycling even when eligible)
- Validates **eligibility vs. application** distinction
- Ensures system handles 0% rate gracefully (no division errors, no negative
  amounts)
- Confirms capacity accounting is correct when nothing is recycled

### 9.2 ADR Clarification Opportunity

**Suggested ADR-007 Amendment:**

Add to Section 2.X (Recycling Rate Application):

> **Zero Rate Handling:** When `exitRecyclingRate = 0%`, all proceeds are
> returned to LPs regardless of period eligibility or capacity availability. The
> recycling rate acts as a policy override on eligibility, allowing funds to
> disable recycling for specific exits even when within the recycling period.
> Remaining capacity is preserved (unchanged) for future exits with non-zero
> rates.

**Benefit:** Explicitly documents implicit behavior tested by ER-010.

### 9.3 Implementation Considerations

**Code Implications:**

```typescript
// Pseudo-code for zero rate handling
function applyRecyclingRate(
  fundProceeds: number,
  rate: number
): RecyclingResult {
  if (rate === 0) {
    // Short-circuit: all proceeds to LPs, no capacity consumed
    return {
      recycled: 0,
      returnedToLPs: fundProceeds,
      capacityConsumed: 0,
    };
  }

  // Normal recycling logic for rate > 0
  const recycled = fundProceeds * (rate / 100);
  return {
    recycled: recycled,
    returnedToLPs: fundProceeds - recycled,
    capacityConsumed: recycled,
  };
}
```

**Performance Note:** Zero rate short-circuit avoids unnecessary capacity
calculations.

### 9.4 Related Scenarios

**Contrast with:**

- **ER-004:** 75% rate (partial recycling)
- **ER-006:** 100% rate (full recycling, cap exactly reached)
- **ER-013:** Within-period baseline (validates eligibility flag)

**Together these validate:**

- Rate spectrum: 0% → 75% → 100%
- Eligibility independence from rate
- Capacity consumption tied to recycled amount, not eligibility

---

## 10. Next Actions

### 10.1 Immediate Actions (Implementation Phase)

1. **Implement Zero Rate Short-Circuit:**
   - Add explicit 0% rate check in recycling calculation logic
   - Return early to avoid unnecessary capacity checks
   - Ensure all proceeds routed to LPs

2. **Add Zero Rate Unit Test:**

   ```typescript
   test('ER-010: Zero recycling rate returns all proceeds to LPs', () => {
     const result = calculateRecycling({
       fundProceeds: 10_000_000,
       recyclingRate: 0,
       remainingCapacity: 15_000_000,
     });

     expect(result.recycled).toBe(0);
     expect(result.returnedToLPs).toBe(10_000_000);
     expect(result.capacityConsumed).toBe(0);
   });
   ```

3. **Validate Period Independence:**
   - Ensure `withinPeriod` calculated before rate application
   - Confirm eligibility flag is independent of rate value

### 10.2 Documentation Actions

1. **Update ADR-007 (Exit Recycling Policy):**
   - Add Section 2.X: "Zero Rate Handling"
   - Clarify eligibility vs. application distinction
   - Document capacity preservation at 0% rate

2. **Update Implementation Docs:**
   - Document zero rate short-circuit in code comments
   - Add edge case handling to developer guide

### 10.3 Validation Actions

1. **Run ER-010 Against Implementation:**
   - Execute test case after code implementation
   - Verify all 7 invariants pass in live code
   - Confirm tolerance compliance (±0.01)

2. **Cross-Reference with Related Scenarios:**
   - Run ER-004, ER-006, ER-013 alongside ER-010
   - Verify rate spectrum (0% → 75% → 100%) handles correctly
   - Confirm eligibility independence across all rate values

### 10.4 Monitoring Actions

1. **Add Observability:**
   - Log when 0% rate is applied (may indicate configuration issue)
   - Track percentage of exits with zero vs. non-zero rates
   - Alert if 100% of exits have 0% rate (likely misconfiguration)

2. **Performance Metrics:**
   - Measure short-circuit performance gains (if any)
   - Monitor capacity consumption patterns

---

## 11. References

### 11.1 Source Documents

- **Truth Case File:** `docs/exit-recycling.truth-cases.json`
- **Schema:** `docs/schemas/exit-recycling-truth-case.schema.json`
- **ADR:** `docs/adr/ADR-007-exit-recycling-policy.md` (hypothetical, not
  ADR-008)
- **Related ADR:** `docs/adr/ADR-008-capital-allocation-policy.md` (Section 2.5)

### 11.2 Related Scenarios

- **ER-004:** Partial recycling (75% rate) - validates mid-range rate
- **ER-006:** Full recycling (100% rate) - validates maximum rate
- **ER-009:** Low recycling (25% rate) - validates low non-zero rate
- **ER-013:** Within-period validation - validates eligibility flag

### 11.3 Implementation Files (Planned)

- **Exit Recycling Engine:** `client/src/core/recycling/ExitRecyclingEngine.ts`
- **Recycling Calculator:** `client/src/core/recycling/RecyclingCalculator.ts`
- **Unit Tests:** `client/src/core/recycling/__tests__/zero-rate.test.ts`

---

**Evidence Bundle Version:** 1.0.0 **Generated By:** Claude Code (Sonnet 4.5)
**Validation Method:** Arithmetic verification + Node computation + Invariant
checking **Classification:** VALIDATED (Truth Case Confirmed)
