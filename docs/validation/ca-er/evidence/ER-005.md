# Evidence Bundle: ER-005 - Multiple Exits Below Cap with Cumulative Tracking

**Scenario ID:** ER-005 **Category:** schedule_calculation **Status:**
VALIDATION REQUIRED **Generated:** 2025-12-13

---

## 1. Scenario Overview

**Description:** Multiple exits below cap with cumulative tracking

**Focus:** Testing multi-exit coordination with chronological processing,
cumulative recycling tracking, and verification that total recycled capital
stays below the recycling cap when processing multiple exits sequentially.

**Key Constraints:**

- Multiple exits (3 exits) across different years
- All exits occur within recycling period (years 2, 3, 4 of 5-year period)
- 75% recycling rate applied consistently
- Total recycled capital ($13.875M) stays below cap ($15M)
- Cumulative tracking across years

---

## 2. Input Data (Verbatim from JSON)

```json
{
  "fundSize": 100,
  "recyclingCapPercent": 15,
  "recyclingPeriod": 5,
  "exitRecyclingRate": 75,
  "exits": [
    {
      "id": "exit-a",
      "year": 2,
      "grossProceeds": 30,
      "ownershipPercent": 25
    },
    {
      "id": "exit-b",
      "year": 3,
      "grossProceeds": 40,
      "ownershipPercent": 20
    },
    {
      "id": "exit-c",
      "year": 4,
      "grossProceeds": 20,
      "ownershipPercent": 15
    }
  ]
}
```

**Interpretation:**

- Fund size: $100M
- Recycling cap: 15% of fund = $15M
- Recycling period: 5 years
- Exit recycling rate: 75%
- Three exits within period:
  - Exit A (year 2): Gross $30M × 25% ownership = $7.5M fund proceeds
  - Exit B (year 3): Gross $40M × 20% ownership = $8M fund proceeds
  - Exit C (year 4): Gross $20M × 15% ownership = $3M fund proceeds
  - Total fund proceeds: $18.5M

---

## 3. Expected Output (Verbatim from JSON)

```json
{
  "totalRecycled": 13.875,
  "totalReturnedToLPs": 4.625,
  "remainingCapacity": 1.125,
  "capReached": false,
  "recyclingByExit": [
    {
      "exitId": "exit-a",
      "exitYear": 2,
      "fundProceeds": 7.5,
      "recycledAmount": 5.625,
      "returnedToLPs": 1.875,
      "withinPeriod": true,
      "appliedRate": 75
    },
    {
      "exitId": "exit-b",
      "exitYear": 3,
      "fundProceeds": 8,
      "recycledAmount": 6,
      "returnedToLPs": 2,
      "withinPeriod": true,
      "appliedRate": 75
    },
    {
      "exitId": "exit-c",
      "exitYear": 4,
      "fundProceeds": 3,
      "recycledAmount": 2.25,
      "returnedToLPs": 0.75,
      "withinPeriod": true,
      "appliedRate": 75
    }
  ],
  "cumulativeByYear": [
    {
      "year": 2,
      "cumulativeRecycled": 5.625,
      "annualRecycled": 5.625
    },
    {
      "year": 3,
      "cumulativeRecycled": 11.625,
      "annualRecycled": 6
    },
    {
      "year": 4,
      "cumulativeRecycled": 13.875,
      "annualRecycled": 2.25
    }
  ]
}
```

**Key Expectations:**

- Total recycled: $13.875M (75% of $18.5M total proceeds)
- Total returned to LPs: $4.625M (25% of $18.5M total proceeds)
- Remaining capacity: $1.125M ($15M cap - $13.875M recycled)
- Cap not reached (cumulative < cap)
- All exits within period (years 2-4 of 5-year period)
- Cumulative tracking shows progression: $5.625M → $11.625M → $13.875M

---

## 4. ADR Provenance

### ADR-008 Section 2.5: Exit Recycling Integration

**Relevant Policy:**

> "Eligible distributions increase allocable capacity after reserve checks: When
> an exit generates proceeds that are eligible for recycling, these funds are
> added to the allocable capacity, but only after the reserve engine has
> verified that reserve requirements are met."

**Applied to ER-005:**

This scenario validates the fundamental exit recycling formula and multi-exit
coordination:

1. **Sequential Processing:**
   - Exits are processed chronologically (year 2 → 3 → 4)
   - Each exit's recycling is calculated independently
   - Cumulative tracking ensures cap enforcement across all exits

2. **Basic Recycling Formula:**
   - `totalRecycled = exitAmount × recyclingRate`
   - `returnedToLPs = exitAmount - totalRecycled`
   - This is the foundational formula for all exit recycling calculations

3. **Capacity Tracking:**
   - Remaining capacity decreases with each exit
   - Year 2: $15M - $5.625M = $9.375M remaining
   - Year 3: $9.375M - $6M = $3.375M remaining
   - Year 4: $3.375M - $2.25M = $1.125M remaining

4. **Period Eligibility:**
   - All exits occur within 5-year recycling period
   - Period eligibility is validated independently of recycling rate
   - `withinPeriod = true` for all three exits

**ADR Section Not Explicitly Covered:** While ADR-008 Section 2.5 discusses
recycling integration with capital allocation, the **basic exit recycling
formula** (amount × rate = recycled) is implicit rather than explicitly
documented. ER-005 validates this foundational arithmetic.

---

## 5. Arithmetic Verification

### Step-by-Step Calculation

**Given:**

- Fund size: $100,000,000
- Recycling cap: 15% = $15,000,000
- Recycling period: 5 years
- Exit recycling rate: 75%

### Exit A (Year 2)

**Step 1: Fund Proceeds**

```
Fund proceeds = Gross proceeds × Ownership %
              = $30,000,000 × 0.25
              = $7,500,000 ✓
```

**Step 2: Recycled Amount**

```
Recycled amount = Fund proceeds × Recycling rate
                = $7,500,000 × 0.75
                = $5,625,000 ✓
```

**Step 3: Returned to LPs**

```
Returned to LPs = Fund proceeds - Recycled amount
                = $7,500,000 - $5,625,000
                = $1,875,000 ✓
```

**Step 4: Cumulative Tracking**

```
Cumulative recycled (Year 2) = $5,625,000
Remaining capacity = $15,000,000 - $5,625,000 = $9,375,000
```

**Step 5: Period Validation**

```
Exit year = 2
Recycling period = 5 years
Within period? = true (2 ≤ 5) ✓
```

---

### Exit B (Year 3)

**Step 1: Fund Proceeds**

```
Fund proceeds = $40,000,000 × 0.20
              = $8,000,000 ✓
```

**Step 2: Recycled Amount**

```
Recycled amount = $8,000,000 × 0.75
                = $6,000,000 ✓
```

**Step 3: Returned to LPs**

```
Returned to LPs = $8,000,000 - $6,000,000
                = $2,000,000 ✓
```

**Step 4: Cumulative Tracking**

```
Annual recycled (Year 3) = $6,000,000
Cumulative recycled = $5,625,000 + $6,000,000 = $11,625,000 ✓
Remaining capacity = $15,000,000 - $11,625,000 = $3,375,000
```

**Step 5: Period Validation**

```
Exit year = 3
Within period? = true (3 ≤ 5) ✓
```

---

### Exit C (Year 4)

**Step 1: Fund Proceeds**

```
Fund proceeds = $20,000,000 × 0.15
              = $3,000,000 ✓
```

**Step 2: Recycled Amount**

```
Recycled amount = $3,000,000 × 0.75
                = $2,250,000 ✓
```

**Step 3: Returned to LPs**

```
Returned to LPs = $3,000,000 - $2,250,000
                = $750,000 ✓
```

**Step 4: Cumulative Tracking**

```
Annual recycled (Year 4) = $2,250,000
Cumulative recycled = $11,625,000 + $2,250,000 = $13,875,000 ✓
Remaining capacity = $15,000,000 - $13,875,000 = $1,125,000 ✓
```

**Step 5: Period Validation**

```
Exit year = 4
Within period? = true (4 ≤ 5) ✓
```

---

### Aggregate Verification

**Total Fund Proceeds:**

```
Total proceeds = $7,500,000 + $8,000,000 + $3,000,000
               = $18,500,000 ✓
```

**Total Recycled:**

```
Total recycled = Total proceeds × Recycling rate
               = $18,500,000 × 0.75
               = $13,875,000 ✓

Alternative: Sum of individual recycled amounts
           = $5,625,000 + $6,000,000 + $2,250,000
           = $13,875,000 ✓
```

**Total Returned to LPs:**

```
Total returned = Total proceeds - Total recycled
               = $18,500,000 - $13,875,000
               = $4,625,000 ✓

Alternative: Sum of individual returned amounts
           = $1,875,000 + $2,000,000 + $750,000
           = $4,625,000 ✓
```

**Cap Check:**

```
Max recyclable capital = $100,000,000 × 0.15 = $15,000,000
Cumulative recycled = $13,875,000
Cap reached? = false ($13,875,000 < $15,000,000) ✓
Remaining capacity = $15,000,000 - $13,875,000 = $1,125,000 ✓
```

### Node Verification

**Output from er005-verify.js:**

```
=== ER-005: Per-Exit Arithmetic ===

exit-a:
  30M × 25% = 7.5M fund proceeds
  7.5M × 0.75 = 5.625M recycled
  7.5M - 5.625M = 1.875M returned
  Reconciliation: 5.625 + 1.875 = 7.5

exit-b:
  40M × 20% = 8M fund proceeds
  8M × 0.75 = 6M recycled
  8M - 6M = 2M returned
  Reconciliation: 6 + 2 = 8

exit-c:
  20M × 15% = 3M fund proceeds
  3M × 0.75 = 2.25M recycled
  3M - 2.25M = 0.75M returned
  Reconciliation: 2.25 + 0.75 = 3

=== Totals ===
Total fund proceeds: 18.5M
Total recycled: 13.875M (18.5M × 0.75)
Total returned: 4.625M (18.5M - 13.875M)

Final Reconciliation: 13.875 + 4.625 = 18.5M
Expected: 18.5M
Match: PASS

=== Validation Against Expected Values ===
Total recycled: 13.875 vs 13.875 - PASS
Total returned: 4.625 vs 4.625 - PASS
```

**Verification Status:** ✓ PASS - All calculations match expected output exactly

---

## 6. Tolerance Check

**Specified Tolerance:** ±0.01 (currency precision)

### Aggregate Fields

| Field              | Expected | Calculated | Difference | Within Tolerance? |
| ------------------ | -------- | ---------- | ---------- | ----------------- |
| totalRecycled      | 13.875   | 13.875     | 0.00       | ✓ PASS            |
| totalReturnedToLPs | 4.625    | 4.625      | 0.00       | ✓ PASS            |
| remainingCapacity  | 1.125    | 1.125      | 0.00       | ✓ PASS            |

### Exit A Fields

| Field          | Expected | Calculated | Difference | Within Tolerance? |
| -------------- | -------- | ---------- | ---------- | ----------------- |
| fundProceeds   | 7.50     | 7.50       | 0.00       | ✓ PASS            |
| recycledAmount | 5.625    | 5.625      | 0.00       | ✓ PASS            |
| returnedToLPs  | 1.875    | 1.875      | 0.00       | ✓ PASS            |

### Exit B Fields

| Field          | Expected | Calculated | Difference | Within Tolerance? |
| -------------- | -------- | ---------- | ---------- | ----------------- |
| fundProceeds   | 8.00     | 8.00       | 0.00       | ✓ PASS            |
| recycledAmount | 6.00     | 6.00       | 0.00       | ✓ PASS            |
| returnedToLPs  | 2.00     | 2.00       | 0.00       | ✓ PASS            |

### Exit C Fields

| Field          | Expected | Calculated | Difference | Within Tolerance? |
| -------------- | -------- | ---------- | ---------- | ----------------- |
| fundProceeds   | 3.00     | 3.00       | 0.00       | ✓ PASS            |
| recycledAmount | 2.25     | 2.25       | 0.00       | ✓ PASS            |
| returnedToLPs  | 0.75     | 0.75       | 0.00       | ✓ PASS            |

### Cumulative Tracking Fields

| Year | Field              | Expected | Calculated | Difference | Within Tolerance? |
| ---- | ------------------ | -------- | ---------- | ---------- | ----------------- |
| 2    | cumulativeRecycled | 5.625    | 5.625      | 0.00       | ✓ PASS            |
| 2    | annualRecycled     | 5.625    | 5.625      | 0.00       | ✓ PASS            |
| 3    | cumulativeRecycled | 11.625   | 11.625     | 0.00       | ✓ PASS            |
| 3    | annualRecycled     | 6.00     | 6.00       | 0.00       | ✓ PASS            |
| 4    | cumulativeRecycled | 13.875   | 13.875     | 0.00       | ✓ PASS            |
| 4    | annualRecycled     | 2.25     | 2.25       | 0.00       | ✓ PASS            |

**Currency Precision:** All amounts in millions ($M), rounded to 2 decimal
places per tolerance spec.

**Tolerance Status:** ✓ PASS - All values exact (zero variance across 18
validated fields)

---

## 7. Invariant Checks

### INV-ER-005-1: Conservation of Capital (Per Exit)

**Rule:** For each exit, fund proceeds = recycled amount + returned to LPs

**Verification:**

```
Exit A: $7.5M = $5.625M + $1.875M ✓
Exit B: $8M = $6M + $2M ✓
Exit C: $3M = $2.25M + $0.75M ✓
```

**Status:** ✓ PASS (3/3 exits)

### INV-ER-005-2: Conservation of Capital (Aggregate)

**Rule:** Total proceeds = Total recycled + Total returned to LPs

**Verification:**

```
$18.5M (total proceeds) = $13.875M (recycled) + $4.625M (returned)
$18.5M = $18.5M ✓
```

**Status:** ✓ PASS

### INV-ER-005-3: Recycling Rate Application

**Rule:** Recycled amount = Fund proceeds × (Rate / 100) for each exit

**Verification:**

```
Exit A: $5.625M = $7.5M × 0.75 ✓
Exit B: $6M = $8M × 0.75 ✓
Exit C: $2.25M = $3M × 0.75 ✓
```

**Status:** ✓ PASS (3/3 exits)

### INV-ER-005-4: Cumulative Monotonicity

**Rule:** Cumulative recycled amount must increase or stay constant (never
decrease)

**Verification:**

```
Year 2: $5.625M
Year 3: $11.625M (≥ $5.625M) ✓
Year 4: $13.875M (≥ $11.625M) ✓
```

**Status:** ✓ PASS

### INV-ER-005-5: Cumulative Accuracy

**Rule:** Cumulative at year N = Sum of all annual amounts through year N

**Verification:**

```
Year 2: $5.625M = $5.625M ✓
Year 3: $11.625M = $5.625M + $6M ✓
Year 4: $13.875M = $5.625M + $6M + $2.25M ✓
```

**Status:** ✓ PASS

### INV-ER-005-6: Annual vs Cumulative Consistency

**Rule:** Annual recycled for year N = Cumulative[N] - Cumulative[N-1]

**Verification:**

```
Year 2: $5.625M = $5.625M - $0 ✓
Year 3: $6M = $11.625M - $5.625M ✓
Year 4: $2.25M = $13.875M - $11.625M ✓
```

**Status:** ✓ PASS

### INV-ER-005-7: Cap Not Exceeded

**Rule:** Cumulative recycled ≤ Max recyclable capital at all times

**Verification:**

```
Max recyclable capital = $15M
Year 2: $5.625M ≤ $15M ✓
Year 3: $11.625M ≤ $15M ✓
Year 4: $13.875M ≤ $15M ✓
```

**Status:** ✓ PASS

### INV-ER-005-8: Remaining Capacity Accuracy

**Rule:** Remaining capacity = Max capital - Cumulative recycled

**Verification:**

```
Remaining capacity = $15M - $13.875M
                   = $1.125M ✓
```

**Status:** ✓ PASS

### INV-ER-005-9: Cap Reached Flag Accuracy

**Rule:** capReached = true if cumulative recycled ≥ max capital

**Verification:**

```
Cumulative recycled = $13.875M
Max capital = $15M
Cap reached? = false ($13.875M < $15M) ✓
```

**Status:** ✓ PASS

### INV-ER-005-10: Period Eligibility Consistency

**Rule:** All exits within period must have withinPeriod = true

**Verification:**

```
Exit A (year 2): 2 ≤ 5 → withinPeriod = true ✓
Exit B (year 3): 3 ≤ 5 → withinPeriod = true ✓
Exit C (year 4): 4 ≤ 5 → withinPeriod = true ✓
```

**Status:** ✓ PASS

### INV-ER-005-11: Applied Rate Consistency

**Rule:** Applied rate in recyclingByExit must match exit recycling rate for all
eligible exits

**Verification:**

```
Exit recycling rate = 75%
Exit A applied rate = 75% ✓
Exit B applied rate = 75% ✓
Exit C applied rate = 75% ✓
```

**Status:** ✓ PASS

### INV-ER-005-12: Non-Negative Values

**Rule:** All monetary amounts must be ≥ 0

**Verification:**

```
All fund proceeds ≥ 0 ✓
All recycled amounts ≥ 0 ✓
All returned amounts ≥ 0 ✓
Remaining capacity ≥ 0 ✓
```

**Status:** ✓ PASS

---

## 8. Classification

**RESULT:** ✓ VALIDATED (Truth Case Confirmed)

**Evidence:**

1. **Arithmetic verification:** All calculations correct (0% variance across 18
   fields)
2. **Tolerance compliance:** All values within ±0.01 tolerance (exact match)
3. **Invariant satisfaction:** 12/12 invariants pass
4. **ADR alignment:** Behavior consistent with basic recycling formula (implicit
   in ADR-008 Section 2.5)
5. **Multi-exit coordination:** Chronological processing, cumulative tracking,
   and capacity management all correct

**Classification Rationale:**

- ER-005 validates the **fundamental exit recycling formula** across multiple
  exits
- Confirms **chronological processing** maintains cumulative accuracy
- Demonstrates **capacity tracking** correctly accounts for sequential exits
- Validates that **cumulative amounts never exceed cap** even with multiple
  exits
- No contradictions found between expected output and policy
- All invariants hold, including conservation of capital and monotonicity

---

## 9. Notes and Observations

### 9.1 Foundational Scenario Significance

**Why This Matters:**

- **Baseline for multi-exit logic:** ER-005 establishes the reference
  implementation for processing multiple exits
- **Cumulative tracking validation:** Proves that annual and cumulative amounts
  reconcile correctly
- **Below-cap baseline:** Creates a baseline for scenarios that will test cap
  enforcement (ER-006, ER-007, ER-011)
- **Formula verification:** Validates the simple but critical formula: recycled
  = proceeds × rate

### 9.2 Design Patterns Validated

**Chronological Processing:**

- Exits processed in year order (2 → 3 → 4)
- Each exit's calculation is independent
- Cumulative state updates after each exit

**Capacity Management:**

- Remaining capacity tracked throughout
- Cap enforcement happens at aggregation, not per-exit
- All exits stay below cap, so no partial recycling needed

**Rate Application:**

- 75% rate applied uniformly to all eligible exits
- No variation based on year or cumulative state
- Rate is policy-level, not exit-specific

### 9.3 Contrast with Related Scenarios

**Compare to:**

- **ER-004 (Single exit, 75% rate):** ER-005 extends to multiple exits, same
  rate
- **ER-006 (Cap exactly reached):** ER-005 stays below cap; ER-006 hits it
  exactly
- **ER-007 (Cap exceeded):** ER-005 below cap; ER-007 tests overflow handling
- **ER-008 (50% rate):** ER-005 uses 75%; ER-008 tests different rate value
- **ER-011 (Mid-exit cap):** ER-005 never caps; ER-011 caps during second exit

**Together these validate:**

- Rate spectrum: 0% → 50% → 75% → 100%
- Exit count: single → multiple
- Cap scenarios: below → exact → exceeded → mid-exit
- Cumulative tracking accuracy across all scenarios

### 9.4 Implementation Considerations

**Code Implications:**

```typescript
// Pseudo-code for multi-exit recycling
interface ExitRecyclingResult {
  exitId: string;
  exitYear: number;
  fundProceeds: number;
  recycledAmount: number;
  returnedToLPs: number;
  withinPeriod: boolean;
  appliedRate: number;
}

function processExits(
  exits: Exit[],
  recyclingRate: number,
  maxCapacity: number,
  recyclingPeriod: number
): {
  recyclingByExit: ExitRecyclingResult[];
  totalRecycled: number;
  totalReturnedToLPs: number;
  remainingCapacity: number;
  capReached: boolean;
} {
  // Sort exits chronologically
  const sortedExits = exits.sort((a, b) => a.year - b.year);

  let cumulativeRecycled = 0;
  const results: ExitRecyclingResult[] = [];

  for (const exit of sortedExits) {
    const fundProceeds = exit.grossProceeds * (exit.ownershipPercent / 100);
    const withinPeriod = exit.year <= recyclingPeriod;

    // Basic formula: recycled = proceeds × rate (if eligible)
    const recycledAmount = withinPeriod
      ? fundProceeds * (recyclingRate / 100)
      : 0;

    const returnedToLPs = fundProceeds - recycledAmount;

    cumulativeRecycled += recycledAmount;

    results.push({
      exitId: exit.id,
      exitYear: exit.year,
      fundProceeds,
      recycledAmount,
      returnedToLPs,
      withinPeriod,
      appliedRate: withinPeriod ? recyclingRate : 0,
    });
  }

  return {
    recyclingByExit: results,
    totalRecycled: cumulativeRecycled,
    totalReturnedToLPs: results.reduce((sum, r) => sum + r.returnedToLPs, 0),
    remainingCapacity: maxCapacity - cumulativeRecycled,
    capReached: cumulativeRecycled >= maxCapacity,
  };
}
```

**Performance Note:** Linear O(n) complexity for n exits after initial sort.

### 9.5 ADR Enhancement Opportunity

**Suggested ADR-008 Section 2.5 Amendment:**

Add explicit documentation of the basic exit recycling formula:

> **Exit Recycling Formula (Basic):**
>
> For each exit that is eligible for recycling (within recycling period):
>
> - `fundProceeds = grossProceeds × (ownershipPercent / 100)`
> - `recycledAmount = fundProceeds × (exitRecyclingRate / 100)`
> - `returnedToLPs = fundProceeds - recycledAmount`
>
> Exits are processed chronologically (by year). Cumulative recycled capital is
> tracked across all exits and must not exceed the recycling cap
> (`maxRecyclableCapital`).
>
> **Multi-Exit Coordination:**
>
> - Each exit's recycling calculation is independent (no cross-exit
>   dependencies)
> - Cumulative tracking ensures cap enforcement across all exits
> - Remaining capacity = `maxRecyclableCapital - cumulativeRecycled`
> - If cumulative recycled ≥ max capacity, `capReached = true` and subsequent
>   exits may be partially recycled or fully returned to LPs

**Benefit:** Makes the implicit formula explicit, reducing implementation
ambiguity.

---

## 10. Next Actions

### 10.1 Immediate Actions (Implementation Phase)

1. **Implement Multi-Exit Recycling Logic:**
   - Process exits chronologically (sort by year)
   - Apply basic formula to each exit independently
   - Track cumulative recycled amount
   - Calculate remaining capacity after each exit

2. **Add Multi-Exit Unit Tests:**

   ```typescript
   test('ER-005: Multiple exits below cap with cumulative tracking', () => {
     const result = calculateRecycling({
       fundSize: 100_000_000,
       recyclingCapPercent: 15,
       recyclingPeriod: 5,
       exitRecyclingRate: 75,
       exits: [
         {
           id: 'exit-a',
           year: 2,
           grossProceeds: 30_000_000,
           ownershipPercent: 25,
         },
         {
           id: 'exit-b',
           year: 3,
           grossProceeds: 40_000_000,
           ownershipPercent: 20,
         },
         {
           id: 'exit-c',
           year: 4,
           grossProceeds: 20_000_000,
           ownershipPercent: 15,
         },
       ],
     });

     expect(result.totalRecycled).toBe(13_875_000);
     expect(result.totalReturnedToLPs).toBe(4_625_000);
     expect(result.remainingCapacity).toBe(1_125_000);
     expect(result.capReached).toBe(false);

     // Validate per-exit amounts
     expect(result.recyclingByExit[0].recycledAmount).toBe(5_625_000);
     expect(result.recyclingByExit[1].recycledAmount).toBe(6_000_000);
     expect(result.recyclingByExit[2].recycledAmount).toBe(2_250_000);

     // Validate cumulative tracking
     expect(result.cumulativeByYear[0].cumulativeRecycled).toBe(5_625_000);
     expect(result.cumulativeByYear[1].cumulativeRecycled).toBe(11_625_000);
     expect(result.cumulativeByYear[2].cumulativeRecycled).toBe(13_875_000);
   });
   ```

3. **Implement Cumulative Tracking:**
   - Generate `cumulativeByYear` array
   - Calculate `annualRecycled` as delta from prior year
   - Validate monotonicity (cumulative never decreases)

### 10.2 Documentation Actions

1. **Update ADR-008 Section 2.5:**
   - Add "Exit Recycling Formula (Basic)" subsection
   - Document multi-exit coordination pattern
   - Clarify chronological processing requirement

2. **Create Developer Guide Entry:**
   - Document multi-exit recycling pattern
   - Provide code examples for chronological processing
   - Explain cumulative tracking implementation

### 10.3 Validation Actions

1. **Run ER-005 Against Implementation:**
   - Execute test case after code implementation
   - Verify all 12 invariants pass in live code
   - Confirm tolerance compliance (±0.01) for all 18 fields

2. **Cross-Reference with Related Scenarios:**
   - Run ER-004 (single exit baseline)
   - Run ER-006 (cap exactly reached)
   - Run ER-007 (cap exceeded)
   - Verify consistent behavior across exit counts and cap scenarios

### 10.4 Quality Assurance

1. **Edge Case Testing:**
   - Test with 0 exits (empty array)
   - Test with 1 exit (equivalent to ER-004)
   - Test with 10+ exits (stress test cumulative tracking)
   - Test with exits in reverse chronological order (validate sorting)

2. **Performance Testing:**
   - Benchmark with 100 exits
   - Verify O(n log n) or better complexity
   - Profile cumulative tracking overhead

### 10.5 Integration Actions

1. **Capital Allocation Integration:**
   - Verify recycled capital flows to ReserveEngine
   - Ensure reserve precedence honored (per ADR-008 Section 2.1)
   - Test multi-exit recycling with reserve floor constraints

2. **Reporting Integration:**
   - Generate annual recycling report from `cumulativeByYear`
   - Display cumulative vs. capacity chart
   - Show year-over-year recycling trends

---

## 11. References

### 11.1 Source Documents

- **Truth Case File:** `docs/exit-recycling.truth-cases.json` (lines 105-196)
- **Schema:** `docs/schemas/exit-recycling-truth-case.schema.json`
- **ADR:** `docs/adr/ADR-008-capital-allocation-policy.md` (Section 2.5)
- **Verification Script:** `c:\dev\Updog_restore\er005-verify.js`

### 11.2 Related Scenarios

**Exit Count Progression:**

- **ER-004:** Single exit (baseline for formula)
- **ER-005:** Multiple exits (this scenario)

**Cap Enforcement Spectrum:**

- **ER-005:** Below cap ($13.875M of $15M)
- **ER-006:** Exactly at cap ($15M of $15M)
- **ER-007:** Exceeds cap ($25M proceeds, $15M cap)
- **ER-011:** Mid-exit cap ($10M cap, two exits totaling $14M proceeds)

**Rate Variation:**

- **ER-008:** 50% rate (lower than ER-005)
- **ER-005:** 75% rate (this scenario)
- **ER-006:** 100% rate (maximum recycling)
- **ER-010:** 0% rate (zero recycling edge case)

### 11.3 Implementation Files (Planned)

- **Exit Recycling Engine:** `client/src/core/recycling/ExitRecyclingEngine.ts`
- **Recycling Calculator:** `client/src/core/recycling/RecyclingCalculator.ts`
- **Cumulative Tracker:** `client/src/core/recycling/CumulativeTracker.ts`
- **Unit Tests:** `client/src/core/recycling/__tests__/multi-exit.test.ts`

---

**Evidence Bundle Version:** 1.0.0 **Generated By:** Claude Code (Sonnet 4.5)
**Validation Method:** Arithmetic verification + Node.js computation + Invariant
checking (12 invariants) **Classification:** VALIDATED (Truth Case Confirmed)
**Total Fields Validated:** 18 (all exact match, 0% variance)
