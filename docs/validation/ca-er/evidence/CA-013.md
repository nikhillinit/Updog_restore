# Evidence Bundle — CA-013 (Reserve Precedence)

## 0) Metadata

- Module: capital-allocation
- Scenario ID: CA-013
- Date: 2025-12-13T00:00:00Z
- Branch: main
- Commit: 480c15f59ff438bbeb6d461690b1a6a5cd7f35a1
- Reviewer/Agent: phoenix-capital-allocation-analyst
- Truth-case source file: docs/capital-allocation.truth-cases.json
- ADR/spec source(s): docs/adr/ADR-008-capital-allocation-policy.md

## 1) What this scenario is testing

**Core Principle:** Reserve floor precedence overrides monthly pacing target
when conflict occurs

This scenario tests the **critical precedence rule** defined in ADR-008 Section
2.1:

> Reserve floor → Pacing target → Cohort allocation

Specifically, CA-013 validates that when a contribution arrives and monthly
pacing would suggest deploying a certain amount, but doing so would leave the
reserve below its required floor (max of target_reserve_pct × commitment,
min_cash_buffer), the system:

1. **Prioritizes reserve replenishment first**
2. **Allocates only the residual** to cohorts after satisfying reserve floor
3. **Defers excess pacing demand** to later periods (carryover)
4. **Flags the violation** as "reserve_floor_override_pacing" for observability

**Why This Matters:**

Per ADR-008 Section 4.1, this rule prevents:

- Under-reserving that creates liquidity risk
- Cash shortfalls when supporting portfolio companies
- Covenant breaches requiring minimum reserves

The test case intentionally creates a conflict: an $8M contribution that could
theoretically support the full monthly pacing target of ~$2.1M, but the reserve
floor of 25% × $50M = $12.5M must be satisfied first.

## 2) Inputs (verbatim)

```json
{
  "fund": {
    "commitment": 50000000,
    "target_reserve_pct": 0.25,
    "reserve_policy": "static_pct",
    "pacing_window_months": 24,
    "vintage_year": 2024
  },
  "timeline": {
    "start_date": "2025-01-01",
    "end_date": "2026-12-31"
  },
  "flows": {
    "contributions": [
      {
        "date": "2025-03-01",
        "amount": 8000000
      }
    ],
    "distributions": []
  },
  "constraints": {
    "min_cash_buffer": 5000000,
    "max_allocation_per_cohort": 0.6,
    "rebalance_frequency": "monthly"
  },
  "cohorts": [
    {
      "name": "General",
      "start_date": "2025-01-01",
      "end_date": "2026-12-31",
      "weight": 1
    }
  ]
}
```

## 3) Expected Outputs (verbatim)

```json
{
  "allocations_by_cohort": [
    {
      "cohort": "General",
      "amount": 3000000
    }
  ],
  "reserve_balance_over_time": [
    {
      "date": "2025-03-31",
      "balance": 12500000
    }
  ],
  "pacing_targets_by_period": [
    {
      "period": "2025-03",
      "target": 2083333
    }
  ],
  "violations": ["reserve_floor_override_pacing"]
}
```

## 4) ADR-008 Provenance

### Section 2.1: Core Precedence

> Reserve floor → Pacing target → Cohort allocation
>
> This precedence ensures liquidity protection takes priority over deployment
> smoothness, which in turn takes priority over cohort-level fairness
> considerations.

**Direct Authority:** This is the foundational rule that CA-013 validates.

### Section 2.2: Reserve Policy

> **Floor enforcement**: `max(reserve_target, min_cash_buffer)`
>
> The reserve engine must satisfy its target before any capital is allocated to
> deals. If the reserve balance falls below the floor (which is the maximum of
> the calculated reserve target and the minimum cash buffer), allocations are
> reduced until the reserve is replenished.

**Applied to CA-013:**

- `reserve_target = target_reserve_pct × commitment = 0.25 × $50M = $12.5M`
- `min_cash_buffer = $5M`
- `reserve_floor = max($12.5M, $5M) = $12.5M`

### Section 2.3: Pacing

> Rolling window with carryover: C*t = max(0, P*{t-1} - A\_{t-1})
>
> Pacing smooths deployment over time using a rolling window (typically 12-24
> months). If a period under-deploys relative to its target, the shortfall
> carries forward to the next period.

**Applied to CA-013:**

- `pacing_window_months = 24`
- `monthly_base_target = commitment / 24 = $50M / 24 = $2,083,333.33`
- Since this is the first contribution, no prior carryover exists
- Expected target for 2025-03: $2,083,333 (matches expected output)

### Section 4.1: Rationale - Liquidity Protection (Reserve Precedence)

> Without reserve precedence, aggressive pacing targets could deplete cash
> reserves below safe levels, creating liquidity risk
>
> **Example (CA-013)**: When monthly pacing targets would deplete reserves below
> the floor, the allocation is reduced to preserve liquidity, even if this
> causes under-deployment relative to the pacing target.

**Direct Call-Out:** ADR-008 explicitly names CA-013 as the canonical example of
this rule in action.

### Section 8.1: Coverage Plan

> CA-013: **Reserve precedence over pacing** (conflict resolution)

Classified as one of the critical **conflict resolution** test cases in the
reserve engine category.

### Section 8.2: Adversarial Cases

> CA-013: Reserve overrides pacing (conflict)

Listed as one of the 6 minimum adversarial/edge cases required for validation.

## 5) Step-by-step computation trace

### Step 1: Calculate Reserve Floor

**Formula:**
`reserve_floor = max(target_reserve_pct × commitment, min_cash_buffer)`

**Calculation:**

```
target_reserve = 0.25 × 50,000,000 = 12,500,000
min_cash_buffer = 5,000,000
reserve_floor = max(12,500,000, 5,000,000) = 12,500,000
```

**Verification (Node.js):**

```bash
node -e "console.log('reserve_floor:', Math.max(0.25 * 50000000, 5000000))"
```

Output: `reserve_floor: 12500000`

**Result:** Reserve floor = $12,500,000 ✓

---

### Step 2: Calculate Monthly Pacing Target

**Formula:** `monthly_target = commitment / pacing_window_months`

**Calculation:**

```
commitment = 50,000,000
pacing_window_months = 24
monthly_target = 50,000,000 / 24 = 2,083,333.33
```

**Verification (Node.js):**

```bash
node -e "console.log('pacing_target:', Math.round(50000000 / 24))"
```

Output: `pacing_target: 2083333`

**Result:** Pacing target for 2025-03 = $2,083,333 ✓

---

### Step 3: Process Contribution and Determine Available Capital

**Event:** Contribution of $8,000,000 on 2025-03-01

**Reserve Analysis:**

```
cash_inflow = 8,000,000
current_reserve_balance = 0 (start of fund)
reserve_needs = reserve_floor - current_reserve_balance
reserve_needs = 12,500,000 - 0 = 12,500,000
```

**Verification (Node.js):**

```bash
node -e "const needs = 12500000 - 0; console.log('reserve_needs:', needs)"
```

Output: `reserve_needs: 12500000`

**Capital Allocation:**

```
cash_available_for_allocation = cash_inflow - reserve_needs
cash_available_for_allocation = 8,000,000 - 12,500,000 = -4,500,000
```

**Verification (Node.js):**

```bash
node -e "console.log('available:', 8000000 - 12500000)"
```

Output: `available: -4500000`

**Problem:** We need $12.5M for reserves but only have $8M. This creates a
deficit.

**Resolution:** Reserve floor is **binding**. We can only allocate what remains
after achieving the reserve floor. Since we can't fully satisfy the reserve
floor with this contribution alone, we must:

- Put the entire $8M into reserves
- Allocate $0 to cohorts
- Defer pacing target to next period

**Wait, this contradicts the expected output showing $3M allocation.**

Let me recalculate with the correct interpretation:

---

### Step 3 (Corrected): Reserve Precedence with Partial Satisfaction

**Scenario Interpretation:**

The reserve floor is $12.5M, but we only have $8M in cash. The truth case shows:

- Reserve balance at 2025-03-31: $12.5M
- Cohort allocation: $3M

This suggests **additional contributions** or a different interpretation. Let me
re-examine the inputs.

**Re-reading inputs:** Only ONE contribution on 2025-03-01 for $8M.

**Hypothesis:** The reserve target is achieved over time, not immediately. The
$12.5M reserve balance shown at 2025-03-31 may represent the **target**, not the
actual balance immediately after the $8M contribution.

**Alternative Calculation:**

If we interpret the expected output as:

- Total capital deployed = $3M to cohorts
- Reserve balance = remaining = $8M - $3M = $5M (not $12.5M)

But the expected output explicitly states reserve balance = $12.5M on
2025-03-31.

**Critical Insight:** The timeline spans until 2026-12-31. There may be implicit
assumptions about:

1. Future contributions
2. Reserve accrual over time
3. Multi-period modeling

However, the truth case schema shows only ONE contribution event. This creates
ambiguity.

---

### Step 4: Re-examine ADR-008 for Static Reserve Policy

**ADR-008 Section 2.2:**

> Default: `static_pct` (target_reserve_pct × commitment)

For `static_pct`, the reserve target is **constant** at 25% × $50M = $12.5M.

**Key Question:** How is a $12.5M reserve balance achieved with only $8M in
contributions?

**Possible Interpretations:**

**A) Reserve Floor vs Reserve Balance Reporting:**

- The "reserve_balance_over_time" field reports the **target**, not actual cash
- Actual cash in reserve = $5M (after $3M allocation)
- This would be a documentation issue

**B) Commitment-Based Reserves:**

- Reserves are calculated against total commitment ($50M), not just contributed
  capital
- The fund "pre-allocates" $12.5M conceptually even though cash is $8M
- Allocations are limited by actual cash available

**C) Multi-Period Accumulation:**

- The truth case expects multiple executions over time
- By 2025-03-31, additional contributions have occurred (not shown in inputs)
- This would be a schema completeness issue

**D) Arithmetic Error in Truth Case:**

- Expected reserve balance should be $5M, not $12.5M
- Expected allocation should be $3M (correct)
- This would classify as **TRUTH CASE ERROR**

---

### Step 5: Test with Implementation Logic (Precedence-First)

**Algorithm per ADR-008:**

```typescript
// Pseudocode for capital allocation
function allocateCapital(
  contribution: number,
  reserve_floor: number,
  pacing_target: number
) {
  let available = contribution;
  let reserve_balance = 0;
  let cohort_allocation = 0;

  // STEP 1: Satisfy reserve floor first (precedence)
  const reserve_needs = Math.max(0, reserve_floor - reserve_balance);
  const to_reserve = Math.min(available, reserve_needs);
  reserve_balance += to_reserve;
  available -= to_reserve;

  // STEP 2: Allocate to pacing target (limited by available)
  const to_allocate = Math.min(available, pacing_target);
  cohort_allocation = to_allocate;
  available -= to_allocate;

  // STEP 3: Remaining goes to reserve (if any)
  reserve_balance += available;

  return {
    reserve_balance,
    cohort_allocation,
    pacing_shortfall: pacing_target - cohort_allocation,
  };
}
```

**Application to CA-013:**

```
contribution = 8,000,000
reserve_floor = 12,500,000
pacing_target = 2,083,333

reserve_needs = 12,500,000 - 0 = 12,500,000
to_reserve = min(8,000,000, 12,500,000) = 8,000,000
reserve_balance = 8,000,000
available = 8,000,000 - 8,000,000 = 0

to_allocate = min(0, 2,083,333) = 0
cohort_allocation = 0
```

**Verification (Node.js):**

```bash
node -e "
const contrib = 8000000;
const floor = 12500000;
const target = 2083333;
let avail = contrib;
let reserve = 0;

const needs = Math.max(0, floor - reserve);
const to_res = Math.min(avail, needs);
reserve += to_res;
avail -= to_res;

const to_alloc = Math.min(avail, target);
console.log('reserve:', reserve);
console.log('allocation:', to_alloc);
console.log('shortfall:', target - to_alloc);
"
```

Output:

```
reserve: 8000000
allocation: 0
shortfall: 2083333
```

**Discrepancy Found:**

| Field             | Expected    | Computed   | Difference  |
| ----------------- | ----------- | ---------- | ----------- |
| reserve_balance   | $12,500,000 | $8,000,000 | -$4,500,000 |
| cohort_allocation | $3,000,000  | $0         | -$3,000,000 |

---

### Step 6: Alternative Interpretation - Reserve Target vs Commitment Reserve

**Hypothesis:** The reserve balance might be reported as a percentage of **total
commitment**, not actual cash.

**Test:**

```
reserve_balance_reported = target_reserve_pct × commitment = 0.25 × 50M = 12.5M (conceptual)
actual_cash_in_reserve = 8M - 3M = 5M
```

But this contradicts ADR-008's definition of reserve balance as actual cash
held.

---

### Step 7: Reverse Engineering from Expected Outputs

**Given Expected Outputs:**

- Cohort allocation = $3M
- Reserve balance = $12.5M
- Total = $3M + $12.5M = $15.5M

**But contribution = $8M**

**Deficit = $15.5M - $8M = $7.5M**

**Where does $7.5M come from?**

**Possible Sources:**

1. **Unreported contributions** in the timeline
2. **Initial fund NAV** (carry-forward from prior year)
3. **Schema error** (inputs incomplete)
4. **Truth case arithmetic error**

Given that the scenario description states:

> "Reserve floor precedence overrides monthly pacing; **defer excess**."

The word "defer" suggests that some allocation **does not happen**, implying:

- Available capital < pacing target
- Reserve floor binds
- Allocation is reduced

But the expected output shows $3M allocation, which is **more** than what's
available after satisfying reserves.

---

## 6) Precision & tolerance check

**CRITICAL ISSUE IDENTIFIED:** The arithmetic does not reconcile. Before
applying tolerance checks, we must resolve the fundamental discrepancy.

**Typed Tolerances (ADR-008):**

- Currency: $0.01
- Percent: 1e-4 (0.01%)
- Ratio: 1e-4

**Comparison:**

| Field                        | Expected    | Computed   | Abs Diff   | Tolerance | Pass?    |
| ---------------------------- | ----------- | ---------- | ---------- | --------- | -------- |
| reserve_balance (2025-03-31) | $12,500,000 | $8,000,000 | $4,500,000 | $0.01     | **FAIL** |
| cohort[General].amount       | $3,000,000  | $0         | $3,000,000 | $0.01     | **FAIL** |
| pacing_target (2025-03)      | $2,083,333  | $2,083,333 | $0         | $0.01     | PASS     |

**Violations:** 2 major violations exceeding tolerance by orders of magnitude.

---

## 7) Invariant checks (ADR-008 Section 2)

**Invariant 1: Reserve Floor Enforcement**

> `reserve_balance >= max(target_reserve_pct × commitment, min_cash_buffer)`

**Expected:** $12.5M >= $12.5M ✓ (passes) **Computed:** $8M >= $12.5M ✗ (fails)

**Status:** **VIOLATED** in computed trace

---

**Invariant 2: Precedence Order**

> Reserve floor → Pacing target → Cohort allocation

**Expected behavior:** Reserve is satisfied first ($12.5M), then allocations
happen **Computed behavior:** Reserve receives $8M (all available), allocation =
$0

**Status:** **RESPECTED** in computed trace (but violates Invariant 1)

---

**Invariant 3: Pacing Carryover Non-Negative**

> `carryover_t = max(0, pacing_target_{t-1} - actual_allocation_{t-1})`

**Pacing target:** $2,083,333 **Actual allocation (computed):** $0 **Carryover
to 2025-04:** $2,083,333

**Status:** **VALID**

---

**Invariant 4: Cohort Weights Sum to 1.0**

> `Σ(cohort.weight) = 1.0` for active cohorts

**Input:** Single cohort "General" with weight = 1.0

**Status:** **VALID**

---

**Invariant 5: Max Per-Cohort Cap**

> `cohort_allocation <= max_allocation_per_cohort × total_allocation`

**Expected:**

```
total_allocation = 3,000,000
max_per_cohort = 0.6
max_allowed_for_General = 0.6 × 3,000,000 = 1,800,000
actual_General = 3,000,000
```

**Violation:** $3M > $1.8M ✗

**Computed:** $0 allocation, so trivially valid ✓

**Status:** **VIOLATED** in expected output

---

**Invariant 6: Conservation of Capital**

> `total_contributions - total_distributions = reserve_balance + Σ(cohort_allocations)`

**Expected:**

```
contributions = 8,000,000
distributions = 0
left_side = 8,000,000

reserve = 12,500,000
allocations = 3,000,000
right_side = 15,500,000
```

**Balance:** $8M ≠ $15.5M ✗

**Computed:**

```
left_side = 8,000,000
reserve = 8,000,000
allocations = 0
right_side = 8,000,000
```

**Balance:** $8M = $8M ✓

**Status:** **VIOLATED** in expected output; **VALID** in computed trace

---

**Invariant 7: Recycling Eligibility**

> Eligible distributions increase allocable capacity; capital recalls (negative)
> are NOT eligible

**N/A:** No distributions in CA-013

**Status:** Not applicable

---

## 8) Classification

**TRUTH CASE ERROR**

**Rationale:**

The expected outputs in CA-013 violate multiple fundamental invariants:

1. **Conservation of Capital Violation:** Expected outputs show $15.5M in
   reserve + allocations from an $8M contribution, creating $7.5M out of thin
   air.

2. **Reserve Floor Violation:** If the reserve balance is truly $12.5M as
   reported, and $3M is allocated to cohorts, the source of $15.5M total capital
   is unexplained given only $8M in contributions.

3. **Cohort Cap Violation:** Expected allocation of $3M to a single cohort with
   `max_allocation_per_cohort = 0.6` would require total allocation of at least
   $5M (since $3M / 0.6 = $5M), but only $3M total is allocated.

4. **Arithmetic Inconsistency:** The scenario cannot simultaneously satisfy:
   - Single $8M contribution
   - $12.5M reserve balance
   - $3M cohort allocation
   - Conservation of capital

**Hypothesis:**

The truth case author likely intended to demonstrate reserve precedence by
showing:

- Reserve floor = $12.5M (target)
- Pacing target = $2.083M
- Contribution = $8M insufficient to satisfy both
- Allocation reduced to preserve reserves

But made an arithmetic error in calculating the expected outputs. The
**correct** expected outputs should be:

```json
{
  "allocations_by_cohort": [
    {
      "cohort": "General",
      "amount": 0
    }
  ],
  "reserve_balance_over_time": [
    {
      "date": "2025-03-31",
      "balance": 8000000
    }
  ],
  "pacing_targets_by_period": [
    {
      "period": "2025-03",
      "target": 2083333
    }
  ],
  "violations": ["reserve_floor_binding_deferred_allocation"]
}
```

**Alternative Classifications Considered:**

- **ADR AMBIGUOUS:** Rejected. ADR-008 is clear on precedence and conservation
  principles.
- **CODE BUG:** Rejected. No code exists yet; this is pure specification
  validation.
- **MISSING FEATURE:** Rejected. No feature gap; the logic is well-defined.
- **PRECISION HAZARD:** Rejected. The discrepancies are $4.5M and $3M, not
  rounding errors.

---

## 9) Next actions

### Immediate Actions

**1. Clarify Truth Case Intent with Stakeholders**

- **Action:** Post in Capital Allocation Working Group channel
- **Question:** "CA-013: Is the scenario intended to model a single $8M
  contribution, or are there implicit prior contributions creating a $12.5M
  starting reserve?"
- **Assignee:** phoenix-capital-allocation-analyst
- **Timeline:** Response required before proceeding to Step 4

**2. Review Related Scenarios for Pattern**

- **Action:** Check if CA-007 (year-end cutoff) or other multi-period scenarios
  show similar "reserve balance > contributions" patterns
- **Goal:** Determine if this is a schema convention (e.g., "reserve_balance"
  means target, not actual) or isolated error
- **Assignee:** Evidence bundle reviewer
- **Timeline:** Complete within 24h

**3. Validate Schema Documentation**

- **File:** `docs/schemas/capital-allocation-truth-case.schema.json`
- **Check:** Does the schema define "reserve_balance_over_time[].balance" as
  actual cash or target/goal?
- **Action:** If ambiguous, propose schema clarification PR
- **Assignee:** Schema working group

### Proposed Truth Case Correction (Pending Stakeholder Confirmation)

**If stakeholders confirm single $8M contribution is intended:**

```json
{
  "id": "CA-013",
  "expected": {
    "allocations_by_cohort": [
      {
        "cohort": "General",
        "amount": 0
      }
    ],
    "reserve_balance_over_time": [
      {
        "date": "2025-03-31",
        "balance": 8000000
      }
    ],
    "pacing_targets_by_period": [
      {
        "period": "2025-03",
        "target": 2083333
      }
    ],
    "violations": ["reserve_floor_binding_deferred_allocation"]
  },
  "notes": "Reserve floor of $12.5M cannot be satisfied with $8M contribution; all capital held in reserve, cohort allocation deferred to next period with pacing carryover."
}
```

**Alternatively, if multi-period model is intended:**

Add explicit contributions to inputs:

```json
{
  "flows": {
    "contributions": [
      {
        "date": "2025-01-15",
        "amount": 7500000,
        "note": "Initial capital call to establish reserve base"
      },
      {
        "date": "2025-03-01",
        "amount": 8000000,
        "note": "Deployment-phase contribution"
      }
    ]
  }
}
```

This would yield:

- Total contributions = $15.5M
- Reserve = $12.5M (floor satisfied)
- Available for allocation = $15.5M - $12.5M = $3M
- Cohort allocation = $3M ✓
- Conservation holds ✓

### Documentation Actions

**4. Create ERRATA.md Entry**

- **File:** `docs/validation/ca-er/ERRATA.md`
- **Content:**

  ```markdown
  ## CA-013: Reserve Precedence - Arithmetic Inconsistency

  **Status:** Under investigation (2025-12-13)

  **Issue:** Expected outputs violate conservation of capital:

  - Inputs show single $8M contribution
  - Outputs show $12.5M reserve + $3M allocation = $15.5M total
  - Deficit: $7.5M unexplained

  **Impact:** Cannot validate implementation until truth case is corrected

  **Pending:** Capital Allocation WG clarification on multi-period intent
  ```

**5. Update Validation Status**

- **File:** `docs/validation/ca-er/VALIDATION-STATUS.md`
- **Entry:**
  ```markdown
  | CA-013 | Reserve Precedence | BLOCKED | TRUTH CASE ERROR | Arithmetic
  violation |
  ```

### Governance Actions

**6. ADR-008 Amendment (If Needed)**

- **Trigger:** If stakeholders confirm that "reserve_balance" reporting
  convention differs from cash accounting
- **Action:** Propose ADR-008 Section 2.2 amendment clarifying:
  - `reserve_balance_actual` = cash held in reserve account
  - `reserve_balance_target` = policy-defined reserve floor
  - Truth cases must report both fields to avoid confusion
- **Assignee:** ADR author
- **Timeline:** Before Phase 3A completion

### Testing Actions

**7. Defer Implementation Testing**

- **Blocker:** Cannot write unit tests for ReserveEngine until truth case is
  reconciled
- **Action:** Mark CA-013 as "SKIPPED" in test suite with reference to this
  evidence bundle
- **Code:**
  ```typescript
  it.skip('CA-013: Reserve precedence over pacing', () => {
    // BLOCKED: Truth case arithmetic error under investigation
    // See: docs/validation/ca-er/evidence/CA-013.md
  });
  ```

**8. Create Alternative Test Case**

- **Name:** CA-013-ALT
- **Purpose:** Demonstrate reserve precedence with valid arithmetic
- **Inputs:**
  ```json
  {
    "fund": { "commitment": 50000000, "target_reserve_pct": 0.15, ... },
    "flows": {
      "contributions": [
        { "date": "2025-03-01", "amount": 10000000 }
      ]
    }
  }
  ```
- **Expected:**
  ```json
  {
    "reserve_balance": 7500000,
    "allocations_by_cohort": [{ "cohort": "General", "amount": 2500000 }],
    "violations": ["reserve_floor_precedence_applied"]
  }
  ```
- **Verification:**
  - Reserve floor = 15% × $50M = $7.5M
  - Available after reserve = $10M - $7.5M = $2.5M
  - Pacing target = $50M / 24 = $2.083M
  - Allocation = min($2.5M, $2.083M) = $2.083M (limited by availability)
  - Conservation: $10M = $7.5M + $2.5M ✓

---

**Checkpoint:** All actions above must be completed before proceeding to Step 4
(Evidence-Based Repair).

**Critical Path:** Item #1 (stakeholder clarification) is a **BLOCKER** for all
other actions.

**Estimated Timeline:** 2-5 business days depending on working group response
time.

---

**Evidence Bundle Status:** COMPLETE (analysis phase) **Next Phase:** Awaiting
stakeholder input for resolution pathway **Owner:**
phoenix-capital-allocation-analyst **Escalation:** If no response within 5
business days, escalate to ADR-008 document owner
