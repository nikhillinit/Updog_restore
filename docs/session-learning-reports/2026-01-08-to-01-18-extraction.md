# Session Learnings Report: January 8-18, 2026

**Generated:** 2026-01-18
**Date Range:** 2026-01-08 to 2026-01-18
**Sessions Analyzed:** 20 largest sessions (170MB+ conversation data)
**Topics Identified:** TypeScript campaigns, test remediation, CI/CD fixes, router patterns, idempotency

---

## Major Topics from This Period

1. **TypeScript Error Reduction Campaign** - 119 → 21 errors (82.4% reduction)
2. **Test Remediation** - 113 skipped tests analysis, quarantine documentation
3. **CI/CD Stability** - Discovery routing determinism, bundle size checks
4. **Router Pattern System** - 32 → 82 patterns, substring matching issues
5. **Idempotency Middleware** - Fire-and-forget race conditions
6. **Planning-with-files Integration** - Session context management

---

## Learning Candidates

### Candidate 1: Recharts Formatter Type Signatures
- **Score:** 5/10 (repeated pattern +3, DX friction +2)
- **Source:** TypeScript error reduction sessions
- **Category:** TypeScript
- **Anti-Pattern:** Using `(name: string)` for Recharts Tooltip formatters when `name` can be undefined
- **Fix:** Use `(name: string | undefined)` for all Recharts formatter callbacks
- **Recommendation:** CREATE REFLECTION

### Candidate 2: Pre-Push Hook Failures Block Unrelated Changes
- **Score:** 4/10 (DX friction +2, workflow +2)
- **Source:** TypeScript PR push failures
- **Category:** Workflow
- **Anti-Pattern:** Pre-push hooks running full test suite block commits for unrelated failures
- **Fix:** Use `--no-verify` for urgent pushes; document pre-existing failures in CI-PHILOSOPHY.md
- **Recommendation:** SKIP (workflow, already documented)

### Candidate 3: Fire-and-Forget Async Creates Race Conditions
- **Score:** 6/10 (production impact +2, repeated pattern +3, debugging time +1)
- **Source:** Idempotency-dedupe test failures
- **Category:** Infrastructure
- **Anti-Pattern:** Fire-and-forget `storeResponse()` pattern allows subsequent requests before storage completes
- **Fix:** Await storage operations or use mutex/queue for sequential access
- **Recommendation:** CREATE REFLECTION

### Candidate 4: Router Substring Matching Causes False Positives
- **Score:** 5/10 (DX friction +2, repeated pattern +3)
- **Source:** Router pattern system work
- **Category:** Infrastructure
- **Anti-Pattern:** Router uses `includes()` for pattern matching - "brainstorm" matches "ai" pattern because it contains "ai"
- **Fix:** Use word boundary matching (`\b`) or exact token matching; avoid short keywords
- **Recommendation:** CREATE REFLECTION

### Candidate 5: Test Key Reuse Across Test Cases
- **Score:** 5/10 (repeated pattern +3, debugging time +2)
- **Source:** Idempotency test failures (Codex analysis)
- **Category:** Testing
- **Anti-Pattern:** Reusing keys (`key-1`, `key-2`) across tests without clearing Redis stub between tests
- **Fix:** Use unique keys per test (`${testName}-${uuid}`) or clear all stores in beforeEach
- **Recommendation:** CREATE REFLECTION

### Candidate 6: PostgreSQL Service Missing Test Database
- **Score:** 4/10 (infrastructure +2, CI impact +2)
- **Source:** CI failure analysis
- **Category:** Database
- **Anti-Pattern:** Assuming PostgreSQL service has `test` database pre-created
- **Fix:** Add `CREATE DATABASE IF NOT EXISTS test` to CI setup or use template database
- **Recommendation:** CREATE REFLECTION

### Candidate 7: Generator Output vs Manual Edits
- **Score:** 4/10 (DX friction +2, maintenance +2)
- **Source:** Router pattern regeneration
- **Category:** Infrastructure
- **Anti-Pattern:** Manually editing generated files (router-fast.json) that get overwritten
- **Fix:** Edit source files (DISCOVERY-MAP.source.yaml) and regenerate; never edit generated outputs
- **Recommendation:** SKIP (already documented in cheatsheets)

### Candidate 8: Vitest Include Patterns Miss New Test Directories
- **Score:** 4/10 (DX friction +2, testing +2)
- **Source:** Reflection test setup
- **Category:** Testing
- **Anti-Pattern:** Adding test files outside vitest's include patterns - tests silently don't run
- **Fix:** Check `vitest.config.ts` include patterns when adding tests to new directories
- **Recommendation:** CREATE REFLECTION

### Candidate 9: CI Workflow Permission Errors
- **Score:** 3/10 (infrastructure +2, debugging +1)
- **Source:** Bundle size PR comment failures
- **Category:** CI/CD
- **Anti-Pattern:** "HttpError: Not Found" from GitHub API when workflow lacks permissions
- **Fix:** Check workflow permissions in YAML; add `pull-requests: write` for PR comments
- **Recommendation:** CREATE REFLECTION

### Candidate 10: TypeScript Baseline Prevents Merge Despite Progress
- **Score:** 4/10 (DX friction +2, workflow +2)
- **Source:** TypeScript PR discussions
- **Category:** TypeScript
- **Anti-Pattern:** Strict baseline check blocks PRs that reduce errors but don't reach zero
- **Fix:** Use delta comparison (no NEW errors) not absolute comparison; document in CI-PHILOSOPHY.md
- **Recommendation:** SKIP (already in CI-PHILOSOPHY.md)

---

## Summary

| Candidate | Score | Action |
|-----------|-------|--------|
| 1. Recharts Formatter Types | 5 | CREATE REFLECTION |
| 2. Pre-Push Hook Failures | 4 | SKIP |
| 3. Fire-and-Forget Race Conditions | 6 | CREATE REFLECTION |
| 4. Router Substring Matching | 5 | CREATE REFLECTION |
| 5. Test Key Reuse | 5 | CREATE REFLECTION |
| 6. PostgreSQL Test Database | 4 | CREATE REFLECTION |
| 7. Generator Output Edits | 4 | SKIP |
| 8. Vitest Include Patterns | 4 | CREATE REFLECTION |
| 9. CI Workflow Permissions | 3 | CREATE REFLECTION |
| 10. TypeScript Baseline Blocking | 4 | SKIP |

---

## Actions

1. [x] Create REFL-011 for "Recharts Formatter Type Signatures"
2. [x] Create REFL-012 for "Fire-and-Forget Async Creates Race Conditions"
3. [x] Create REFL-013 for "Router Substring Matching Causes False Positives"
4. [x] Create REFL-014 for "Test Key Reuse Across Test Cases"
5. [x] Create REFL-015 for "PostgreSQL Service Missing Test Database"
6. [x] Create REFL-016 for "Vitest Include Patterns Miss New Test Directories"
7. [x] Create REFL-017 for "CI Workflow Permission Errors"

---

## Session Themes

### Week 2 Focus Areas
1. **TypeScript Campaign** - Systematic 82% error reduction across 15 batches
2. **Test Infrastructure** - Quarantine documentation, skip remediation planning
3. **CI Stability** - Discovery routing, bundle size, workflow permissions
4. **Reflection System** - Team Memory implementation and initial extractions
5. **Router Patterns** - 50+ new patterns, substring matching documentation
