name: Auto Label PR

on:
  pull_request:
    types: [opened, synchronize, edited]

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  label:
    runs-on: ubuntu-latest
    name: Label PR
    steps:
      - name: Checkout
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683
        
      - name: Apply Labels
        uses: actions/labeler@8558fd74291d67161a8a78ce36a881fa63b766a9
        with:
          configuration-path: .github/labeler.yml
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Check for E2E requirement
        id: check-e2e
        uses: actions/github-script@60a0d83039c74a4aee543508d2ffcb1c3799cdea
        with:
          script: |
            const { data: labels } = await github.rest.issues.listLabelsOnIssue({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number
            });
            
            const hasE2ELabel = labels.some(label => label.name === 'e2e-required');
            core.setOutput('needs-e2e', hasE2ELabel);
            
            if (hasE2ELabel) {
              console.log('ðŸŽ¯ E2E tests required - risky paths detected');
            } else {
              console.log('âœ… No risky paths - E2E tests optional');
            }
            
            return hasE2ELabel;
            
      - name: Trigger E2E Tests
        if: steps.check-e2e.outputs.needs-e2e == 'true'
        uses: actions/github-script@60a0d83039c74a4aee543508d2ffcb1c3799cdea
        with:
          script: |
            // Add comment to notify about E2E requirement
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: `ðŸŽ¯ **E2E Tests Required**
              
              This PR touches risky paths that require end-to-end testing:
              - Fund setup wizard components
              - State management (stores/selectors)
              - Feature flags or rollout configuration
              - Core business logic
              
              E2E tests will run automatically on the next CI build.`
            });
            
            // You could also trigger a workflow dispatch here if needed
            console.log('E2E test notification added to PR');
