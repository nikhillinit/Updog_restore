name: Block stale API stub
on: [push, pull_request]
jobs:
  guard:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Fail if stub expired & still enabled
        run: |
          EXPIRY="${API_STUB_EXPIRY:-1970-01-01}"
          TODAY="$(date -u +%F)"
          if [[ "${{ secrets.ENABLE_API_STUB }}" == "true" && "$TODAY" > "$EXPIRY" ]]; then
            echo "ENABLE_API_STUB still true after expiry $EXPIRY"; exit 1
          fi